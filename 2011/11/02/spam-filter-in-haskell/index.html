<!DOCTYPE html>
<html>
  <head>
    <title>Spam Filter in Haskell</title>
    
  </head>
  <body>
      <h1><a href="http://tavisharmstrong.com/">Tavish Armstrong</a></h1>
      <h4><span><a href="http://tavisharmstrong.com/about/">About</a></span></h4>

        <h1>Spam Filter in Haskell</h1>
        <h6>Wed 02 Nov 2011 07:00:00</h6>
        <p>Check out this spam filter I wrote in Haskell while watching the
<a href="http://ai-class.com">Stanford AI lectures</a>! The same technique (Naive
Bayes Classification) is used in most effective spam filters, albeit
with more parameters. This version simply calculates the probability of
a word being either spam or ham (the technical term for non-spam), based
on how frequently it occurs in each corpus. At some point I&rsquo;ll probably
test it using comments that I receive on this blog and see how well it
works!</p>

<p>Paul Graham has a very readable explanation of how this works
<a href="http://www.paulgraham.com/spam.html">here</a>.</p>

<p>For those of you who think programming is hard, I&rsquo;m probably going to
convince you further by posting this snippet of incredibly confusing,
poorly written code. Sorry! Read <a href="/2010/12/15/exams-are-almost-over/">this blog post
instead</a>.</p>

<pre><code>:::haskell
import qualified Data.Map as DM
import Text.Printf

-- Some sample text.
spam = &quot;i want to convey my passion for your generosity supporting folks that require assistance with the topic your very own&quot;
ham = &quot;based on your artwork from elementary school i would guess you drew panels 1 and 4 and the camera on wayne coyne microphone you look like a pirate&quot;

fullcorp = spam ++ &quot; &quot; ++ ham

-- Return a Map representing the &quot;Bag of Words&quot; count of all the words in the
-- corpus.
wordFreq :: String -&gt; DM.Map String Float
wordFreq corpus = DM.fromListWith (+) $ [(w, 1.0) | w &lt;- (words corpus)]

-- Count the occurrences of a word in a string.
countWord :: String -&gt; String -&gt; Float
countWord s m = fromIntegral $ length $ filter (==s) $ words m

-- How many unique words are there in a string?
uniqueWords :: String -&gt; Float
uniqueWords = fromIntegral . DM.size . wordFreq

-- Parameter for Laplace smoothing.
smoother :: Float
smoother = 5.0

-- What is the likelihood that  is in a , given a superset
-- of that corpus called , which is all the possible words.
pword :: String -&gt; String -&gt; Float -&gt; String -&gt; Float
pword corpus fullCorpus k word = top/bottom
  where top = k + (countWord word corpus)
        bottom = (fromIntegral $ length . words $ corpus) + k*(uniqueWords fullCorpus)

-- Use this for calculating the p(spam) and p(ham) likelihoods;
-- i.e. a measure of how likely something is to be spam without taking
-- into consideration the contents.
pthing :: Float -&gt; Float -&gt; Float -&gt; Float
pthing count total k = (count + k)/(total + k*2) -- 2 = number of classes (spam, ham)

-- What is the probability that a word is spam?
pspam :: Float
pspam = pthing (fromIntegral . length . words $ spam) (fromIntegral . length . words $ fullcorp) smoother

-- What is the probability that a word is ham?
pham :: Float
pham = pthing (fromIntegral . length . words $ ham) (fromIntegral . length . words $ fullcorp) smoother

-- What is the probability that a message is spam?
pmessagespam :: String -&gt; Float
pmessagespam message = top/bottom
  where top = pspam * product pspamwords
        pspamwords = map (pword spam fullcorp smoother) $ words message
        bottom = top + pham * product phamwords
        phamwords = map (pword ham fullcorp smoother) $ words message

main = do
  -- Print out some probabilities to test.
  putStrLn $ printf &quot;p(spam) = %.9f&quot; $ pspam
  putStrLn $ printf &quot;p(ham) = %.9f&quot; $ pham
  putStrLn $ printf &quot;p(\&quot;my\&quot; | spam) = %.9f&quot; $ pword spam fullcorp smoother &quot;my&quot;
  putStrLn $ printf &quot;p(\&quot;my\&quot; | ham) = %.9f&quot; $ pword ham fullcorp smoother &quot;my&quot;

  putStrLn $ printf &quot;p(\&quot;you\&quot; | spam) = %.9f&quot; $ pword spam fullcorp smoother &quot;you&quot;
  putStrLn $ printf &quot;p(\&quot;you\&quot; | ham) = %.9f&quot; $ pword ham fullcorp smoother &quot;you&quot;
  putStrLn $ printf &quot;vocab %.2f&quot; $ uniqueWords fullcorp

  -- Test a message that is super spammy. Yeah, I get lots of spam that looks like this.
  let message = &quot;your generosity many thanks i want to convey your artwork&quot;

  putStrLn $ printf (&quot;Message: \&quot;&quot; ++ message ++ &quot;\&quot;&quot;)
  putStrLn $ printf &quot;Spam probability: %.9f&quot; $ pmessagespam message

  -- Test something that's kind of nonsensical but is probably not spam.
  let message = &quot;i would guess wayne coyne look like a pirate&quot;
  putStrLn $ printf (&quot;Message: \&quot;&quot; ++ message ++ &quot;\&quot;&quot;)
  putStrLn $ printf &quot;Spam probability: %.9f&quot; $ pmessagespam message

-- $ runhaskell spamfilter.hs
-- p(spam) = 0.431034480
-- p(ham) = 0.568965500
-- p(&quot;my&quot; | spam) = 0.026666667
-- p(&quot;my&quot; | ham) = 0.021459227
-- p(&quot;you&quot; | spam) = 0.022222223
-- p(&quot;you&quot; | ham) = 0.030042918
-- vocab 41.00
-- Message: &quot;your generosity many thanks i want to convey your artwork&quot;
-- Spam probability: 0.716469300
-- Message: &quot;i would guess wayne coyne look like a pirate&quot;
-- Spam probability: 0.194385620
</code></pre>

</body>
</html>

